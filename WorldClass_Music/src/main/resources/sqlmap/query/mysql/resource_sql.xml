<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Resource">

	<select id="Resource_ViewResource" parameterType="qss.vo.KioskVo" resultType="hashmap">
		/*
		  ID  : resource_sql.Resource_ViewResource
		  DEC : 통합 미디어 현황
		*/

		<include refid="Common.BeforeSQL"/>
		 SELECT  A.BRAND_IDX
		      , A.BRAND_NAME
		      , A.FRANC_IDX
		      , A.FRANC_NAME
		      , A.DEVICE_IDX
		      , A.DEVICE_NAME
	          , IFNULL(DEVICE_VERSION, '') AS DEVICE_VERSION
		      , IFNULL(CPU, '0') AS CPU
		      , IFNULL(RAM, '0') AS RAM
		      , IFNULL(HDD, '0') AS HDD
		      , IFNULL(PRINTER, '0') AS PRINTER
		      , IFNULL(CARD, '0') AS CARD
		      , IFNULL(BARCODE, '0') AS BARCODE
		      , IFNULL(NETWORK, '0') AS NETWORK
		      , IFNULL(CONNECT_START_TIME, 0) AS CONNECT_START_TIME
          	  , IFNULL(B.MOD_DATE, '') AS MOD_DATE

		FROM
		(
		  SELECT
			    K.DOMAIN_IDX
          	  , K.BRAND_IDX
		      , K.FRANC_IDX
		      , K.DEVICE_IDX
		      , K.DEVICE_NAME
	          , f.FRANC_NAME
	          , b.NAME AS BRAND_NAME
		  FROM KIOSK K
		  		INNER JOIN franchisee f ON  f.DOMAIN_IDX = K.DOMAIN_IDX AND f.BRAND_IDX = K.BRAND_IDX AND f.FRANC_IDX = K.FRANC_IDX AND ifnull(f.DEL_YN, 'N') = 'N'
      			INNER JOIN brand b ON  b.DOMAIN_IDX = K.DOMAIN_IDX AND b.BRAND_IDX = K.BRAND_IDX AND ifnull(b.DEL_YN, 'N') = 'N'
		  		INNER JOIN sitegroup s ON  f.DOMAIN_IDX = s.DOMAIN_IDX AND f.BRAND_IDX = s.BRAND_IDX AND f.GROUP_IDX = s.GROUP_IDX AND ifnull(s.DEL_YN, 'N') = 'N'
		  WHERE IFNULL(K.DEL_YN, 'N') = 'N'
		  <!-- 시스템 관라지가 아닐경우(서비스) -->
			<if test="sessionBrandIdx != null and sessionAdminType != '' and sessionAdminType == 'ADM0002'">
			 	/* 서비스 관리자는 해당 서비스에 포함된 모든 매장 포함되게 또는 선택한 매장만 */
				AND K.BRAND_IDX = #{sessionBrandIdx}
			</if>
		 ) A LEFT JOIN
		 (

        	SELECT BRAND_IDX
				 , FRANC_IDX
				 , DEVICE_IDX
				  , max(case when RESOURCE_NAME = 'CPU' then RESOURCE_VALUE else '0' end) AS CPU
				  , max(case when RESOURCE_NAME = 'RAM' then RESOURCE_VALUE else '0' end) AS RAM
				  , max(case when RESOURCE_NAME = 'HDD' then RESOURCE_VALUE else '0' end) AS HDD
				  , max(case when RESOURCE_NAME = 'PRINTER' then RESOURCE_VALUE else '0' end) AS PRINTER
				  , max(case when RESOURCE_NAME = 'CARD' then RESOURCE_VALUE else '0' end) AS CARD
				  , max(case when RESOURCE_NAME = 'BARCODE' then RESOURCE_VALUE else '0' end) AS BARCODE
				  , max(case when TIMESTAMPDIFF(second, MOD_DATE, now()) &lt;= 60 then '1' else '0' end) AS NETWORK
				  , max(case when RESOURCE_NAME = 'VERSION' then RESOURCE_VALUE else '' end) AS DEVICE_VERSION
				  , TIMESTAMPDIFF(MINUTE, MAX(CONNECT_START_TIME), now()) AS CONNECT_START_TIME
          		  , MAX(MOD_DATE) AS MOD_DATE
			FROM    KIOSK_RESOURCE KR
			WHERE  1 = 1
			GROUP BY BRAND_IDX, FRANC_IDX, DEVICE_IDX
            ORDER BY BRAND_IDX, FRANC_IDX, DEVICE_IDX
        ) B
        ON  A.BRAND_IDX = B.BRAND_IDX
        AND A.FRANC_IDX = B.FRANC_IDX
        AND A.DEVICE_IDX = B.DEVICE_IDX
        <include refid="Common.AfterSQL"/>
	</select>

	<select id="Resource_ViewCountResource" parameterType="qss.vo.KioskVo" resultType="int">
		/*
		  ID  : resource_sql.Resource_ViewCountResource
		  DEC : 통합 미디어 현황 카운트
		*/
		SELECT COUNT(*)
        FROM
        (
		 SELECT  A.BRAND_IDX
		      , A.BRAND_NAME
		      , A.FRANC_IDX
		      , A.FRANC_NAME
		      , A.DEVICE_IDX
		      , A.DEVICE_NAME
	          , IFNULL(DEVICE_VERSION, '') AS DEVICE_VERSION
		      , IFNULL(CPU, '0') AS CPU
		      , IFNULL(RAM, '0') AS RAM
		      , IFNULL(HDD, '0') AS HDD
		      , IFNULL(PRINTER, '0') AS PRINTER
		      , IFNULL(CARD, '0') AS CARD
		      , IFNULL(BARCODE, '0') AS BARCODE
		      , IFNULL(NETWORK, '0') AS NETWORK
		      , IFNULL(CONNECT_START_TIME, 0) AS CONNECT_START_TIME
          	  , IFNULL(B.MOD_DATE, '') AS MOD_DATE

		FROM
		(
		  SELECT
			    K.DOMAIN_IDX
          	  , K.BRAND_IDX
		      , K.FRANC_IDX
		      , K.DEVICE_IDX
		      , K.DEVICE_NAME
	          , f.FRANC_NAME
	          , b.NAME AS BRAND_NAME
		  FROM KIOSK K
		  		INNER JOIN franchisee f ON  f.DOMAIN_IDX = K.DOMAIN_IDX AND f.BRAND_IDX = K.BRAND_IDX AND f.FRANC_IDX = K.FRANC_IDX AND ifnull(f.DEL_YN, 'N') = 'N'
      			INNER JOIN brand b ON  b.DOMAIN_IDX = K.DOMAIN_IDX AND b.BRAND_IDX = K.BRAND_IDX AND ifnull(b.DEL_YN, 'N') = 'N'
		  		INNER JOIN sitegroup s ON  f.DOMAIN_IDX = s.DOMAIN_IDX AND f.BRAND_IDX = s.BRAND_IDX AND f.GROUP_IDX = s.GROUP_IDX AND ifnull(s.DEL_YN, 'N') = 'N'
		  WHERE IFNULL(K.DEL_YN, 'N') = 'N'
		  <if test="sessionBrandIdx != null and sessionAdminType != '' and sessionAdminType == 'ADM0002'">
		 	/* 서비스 관리자는 해당 서비스에 포함된 모든 매장 포함되게 또는 선택한 매장만 */
			AND K.BRAND_IDX = #{sessionBrandIdx}
		  </if>
		 ) A LEFT JOIN
		 (

        	SELECT BRAND_IDX
				 , FRANC_IDX
				 , DEVICE_IDX
				  , max(case when RESOURCE_NAME = 'CPU' then RESOURCE_VALUE else '0' end) AS CPU
				  , max(case when RESOURCE_NAME = 'RAM' then RESOURCE_VALUE else '0' end) AS RAM
				  , max(case when RESOURCE_NAME = 'HDD' then RESOURCE_VALUE else '0' end) AS HDD
				  , max(case when RESOURCE_NAME = 'PRINTER' then RESOURCE_VALUE else '0' end) AS PRINTER
				  , max(case when RESOURCE_NAME = 'CARD' then RESOURCE_VALUE else '0' end) AS CARD
				  , max(case when RESOURCE_NAME = 'BARCODE' then RESOURCE_VALUE else '0' end) AS BARCODE
				  , max(case when TIMESTAMPDIFF(second, MOD_DATE, now()) &lt;= 60 then '1' else '0' end) AS NETWORK
				  , max(CASE WHEN RESOURCE_NAME = 'VERSION' THEN RESOURCE_VALUE ELSE '' END) AS DEVICE_VERSION
				  , TIMESTAMPDIFF(MINUTE, MAX(CONNECT_START_TIME), now()) AS CONNECT_START_TIME
          		  , MAX(MOD_DATE) AS MOD_DATE
			FROM    KIOSK_RESOURCE KR
			WHERE  1 = 1
			GROUP BY BRAND_IDX, FRANC_IDX, DEVICE_IDX
            ORDER BY BRAND_IDX, FRANC_IDX, DEVICE_IDX
        ) B
        ON  A.BRAND_IDX = B.BRAND_IDX
        AND A.FRANC_IDX = B.FRANC_IDX
        AND A.DEVICE_IDX = B.DEVICE_IDX
     ) A
	</select>

	<select id="Resource_ListResource" parameterType="hashmap" resultType="hashmap">
		/*
		  ID  : resource_sql.Resource_ListResource
		  DEC : 접속 상태 리스트
		*/
		      <include refid="Common.BeforeSQL"/>
				 SELECT  A.BRAND_IDX
				      , A.BRAND_NAME
				      , A.FRANC_IDX
				      , A.FRANC_NAME
				      , A.DEVICE_IDX
				      , A.DEVICE_NAME
				      , IFNULL(DEVICE_VERSION, '') AS DEVICE_VERSION
				      , IFNULL(CPU, '0') AS CPU
				      , IFNULL(RAM, '0') AS RAM
				      , IFNULL(HDD, '0') AS HDD
				      , IFNULL(PRINTER, '0') AS PRINTER
				      , IFNULL(CARD, '0') AS CARD
				      , IFNULL(BARCODE, '0') AS BARCODE
				      , IFNULL(NETWORK, '0') AS NETWORK
				      , IFNULL(CONNECT_START_TIME, 0) AS CONNECT_START_TIME
          	  		  , IFNULL(B.MOD_DATE, '') AS MOD_DATE
          	  		  , IFNULL(C.MAIN_SCHEDULE_NAME, '') AS MAIN_SCHEDULE_NAME
          	  		  , IFNULL(D.CURRENT_SCHEDULE_NAME, '') AS CURRENT_SCHEDULE_NAME
          	  		  , IFNULL(E.THUMBNAIL_PATH, '') AS THUMBNAIL_PATH
				FROM
				(
				  SELECT
						K.DOMAIN_IDX
		          	  , K.BRAND_IDX
				      , K.FRANC_IDX
				      , K.DEVICE_IDX
				      , K.DEVICE_NAME
			          , f.FRANC_NAME
			          , b.NAME AS BRAND_NAME
				  FROM KIOSK K
				  		INNER JOIN franchisee f ON  f.DOMAIN_IDX = K.DOMAIN_IDX AND f.BRAND_IDX = K.BRAND_IDX AND f.FRANC_IDX = K.FRANC_IDX AND ifnull(f.DEL_YN, 'N') = 'N'
      					INNER JOIN brand b ON  b.DOMAIN_IDX = K.DOMAIN_IDX AND b.BRAND_IDX = K.BRAND_IDX AND ifnull(b.DEL_YN, 'N') = 'N'
		  		INNER JOIN sitegroup s ON  f.DOMAIN_IDX = s.DOMAIN_IDX AND f.BRAND_IDX = s.BRAND_IDX AND f.GROUP_IDX = s.GROUP_IDX AND ifnull(s.DEL_YN, 'N') = 'N'
				  WHERE IFNULL(K.DEL_YN, 'N') = 'N'
				  <if test="sessionBrandIdx != null and sessionAdminType != '' and sessionAdminType == 'ADM0002'">
				 	/* 서비스 관리자는 해당 서비스에 포함된 모든 매장 포함되게 또는 선택한 매장만 */
					AND K.BRAND_IDX = #{sessionBrandIdx}
				  </if>

				  <if test="sSearch != null and sSearch != '' and (searhSystemCode == 'SRD0001' or searhSystemCode == '')">
	                AND    b.NAME LIKE CONCAT('%',#{sSearch},'%')
	              </if>

	              <if test="sSearch != null and sSearch != '' and searhSystemCode == 'SRD0002'">
	                AND    f.FRANC_NAME LIKE CONCAT('%',#{sSearch},'%')
	              </if>

	              <if test="sSearch != null and sSearch != '' and searhSystemCode == 'SRD0003'">
	                AND    K.DEVICE_NAME LIKE CONCAT('%',#{sSearch},'%')
	              </if>
				 ) A LEFT JOIN
				 (

		        	SELECT BRAND_IDX
						 , FRANC_IDX
						 , DEVICE_IDX
						  , max(case when RESOURCE_NAME = 'CPU' then RESOURCE_VALUE else '0' end) AS CPU
						  , max(case when RESOURCE_NAME = 'RAM' then RESOURCE_VALUE else '0' end) AS RAM
						  , max(case when RESOURCE_NAME = 'HDD' then RESOURCE_VALUE else '0' end) AS HDD
						  , max(case when RESOURCE_NAME = 'PRINTER' then RESOURCE_VALUE else '0' end) AS PRINTER
						  , max(case when RESOURCE_NAME = 'CARD' then RESOURCE_VALUE else '0' end) AS CARD
						  , max(case when RESOURCE_NAME = 'BARCODE' then RESOURCE_VALUE else '0' end) AS BARCODE
						  , max(case when TIMESTAMPDIFF(second, MOD_DATE, now()) &lt;= 60 then '1' else '0' end) AS NETWORK
						  , max(CASE WHEN RESOURCE_NAME = 'VERSION' THEN RESOURCE_VALUE ELSE '' END) AS DEVICE_VERSION
						  , TIMESTAMPDIFF(MINUTE, MAX(CONNECT_START_TIME), now()) AS CONNECT_START_TIME
          		  		  , MAX(MOD_DATE) AS MOD_DATE
					FROM    KIOSK_RESOURCE KR
					WHERE  1 = 1


					GROUP BY BRAND_IDX, FRANC_IDX, DEVICE_IDX
		            ORDER BY BRAND_IDX, FRANC_IDX, DEVICE_IDX
		        ) B
		        ON  A.BRAND_IDX = B.BRAND_IDX
          		AND A.FRANC_IDX = B.FRANC_IDX
          		AND A.DEVICE_IDX = B.DEVICE_IDX
          		LEFT JOIN
				 (
					SELECT A.MAIN_SCHEDULE_IDX
							,A.BRAND_IDX
							, B.DEVICE_IDX
							,A.MAIN_SCHEDULE_NAME
					FROM MAIN_SCHEDULE A
					LEFT JOIN SCHEDULE_TARGET B ON A.BRAND_IDX = B.BRAND_IDX AND A.MAIN_SCHEDULE_IDX = B.MAIN_SCHEDULE_IDX
					WHERE ACTIVE_YN = 'Y'
						AND DEL_YN = 'N'
						AND SCHEDULE_TYPE IN ('R','T')
						AND(STR_TO_DATE(DATE_FORMAT(NOW(), '%Y-%m-%d'), '%Y-%m-%d') >= STR_TO_DATE(DATE_FORMAT(START_DATE, '%Y-%m-%d'), '%Y-%m-%d')
							AND STR_TO_DATE(DATE_FORMAT(END_DATE, '%Y-%m-%d'), '%Y-%m-%d') >= STR_TO_DATE(DATE_FORMAT(NOW(), '%Y-%m-%d'), '%Y-%m-%d'))
						AND(DATE_FORMAT(NOW(),'%H%i%s') >= START_TIME
							AND END_TIME >= DATE_FORMAT(NOW(),'%H%i%s'))
						AND substring(DAY_OF_WEEK,DAYOFWEEK(DATE_FORMAT(NOW(), '%Y-%m-%d')),1) = 1
					GROUP BY A.BRAND_IDX,B.DEVICE_IDX
					ORDER BY SCHEDULE_TYPE DESC	
		        ) C
		        ON  A.BRAND_IDX = C.BRAND_IDX
		        AND A.DEVICE_IDX = C.DEVICE_IDX
		        
		        LEFT JOIN (
					SELECT KR.DOMAIN_IDX, KR.BRAND_IDX, KR.DEVICE_IDX, MS.MAIN_SCHEDULE_IDX, MS.MAIN_SCHEDULE_NAME AS CURRENT_SCHEDULE_NAME
					FROM (
						SELECT DOMAIN_IDX, BRAND_IDX, FRANC_IDX, DEVICE_IDX 
							, MAX(CASE WHEN RESOURCE_NAME = 'SCHEDULE_IDX' THEN RESOURCE_VALUE ELSE '' END) AS CURRENT_SCHEDULE_IDX
						FROM    KIOSK_RESOURCE
						WHERE  1 = 1
						GROUP BY BRAND_IDX, FRANC_IDX, DEVICE_IDX
						ORDER BY BRAND_IDX, FRANC_IDX, DEVICE_IDX) KR
					INNER JOIN MAIN_SCHEDULE MS ON (KR.DOMAIN_IDX = MS.DOMAIN_IDX AND KR.BRAND_IDX = MS.BRAND_IDX)
					WHERE MS.MAIN_SCHEDULE_IDX = KR.CURRENT_SCHEDULE_IDX
				) D ON A.BRAND_IDX = D.BRAND_IDX AND A.DEVICE_IDX = D.DEVICE_IDX
		        LEFT JOIN (
					SELECT KR.DOMAIN_IDX, KR.BRAND_IDX, KR.DEVICE_IDX, FC.FILE_CONTENT_IDX, FC.THUMBNAIL_PATH
					FROM (
						SELECT DOMAIN_IDX, BRAND_IDX, FRANC_IDX, DEVICE_IDX 
							, MAX(CASE WHEN RESOURCE_NAME = 'FILE_CONTENT_IDX' THEN RESOURCE_VALUE ELSE '' END) AS FILE_CONTENT_IDX
						FROM    KIOSK_RESOURCE
						WHERE  1 = 1
						GROUP BY BRAND_IDX, FRANC_IDX, DEVICE_IDX
						ORDER BY BRAND_IDX, FRANC_IDX, DEVICE_IDX) KR
					INNER JOIN FILE_CONTENT FC ON (KR.FILE_CONTENT_IDX = FC.FILE_CONTENT_IDX)
					WHERE 1=1
				) E ON A.BRAND_IDX = E.BRAND_IDX AND A.DEVICE_IDX = E.DEVICE_IDX 
		        WHERE 1 = 1
		        <if test="serchKey != null and serchKey != '' and serchKey == 'CPU'">
		            AND   (IFNULL(CPU, '0') >= 60 AND IFNULL(NETWORK, '0') = 1)
		        </if>
		        <if test="serchKey != null and serchKey != '' and serchKey == 'RAM'">
		            AND   (IFNULL(RAM, '0') >= 60 AND IFNULL(NETWORK, '0') = 1)
		        </if>
		        <if test="serchKey != null and serchKey != '' and serchKey == 'HDD'">
		            AND   (IFNULL(HDD, '0') >= 60 AND IFNULL(NETWORK, '0') = 1)
		        </if>
		        <if test="serchKey != null and serchKey != '' and serchKey == 'PRINTER'">
		            AND   (IFNULL(PRINTER, '0') = 0 OR IFNULL(NETWORK, '0') = 0)
		        </if>
		        <if test="serchKey != null and serchKey != '' and serchKey == 'CARD'">
		            AND   (IFNULL(CARD, '0') = 0 OR IFNULL(NETWORK, '0') = 0)
		        </if>
		        <if test="serchKey != null and serchKey != '' and serchKey == 'BARCODE'">
		            AND   (IFNULL(BARCODE, '0') = 0 OR IFNULL(NETWORK, '0') = 0)
		        </if>
		        <if test="serchKey != null and serchKey != '' and serchKey == 'NETWORK'">
		            AND   IFNULL(NETWORK, '0') = 0
		        </if>
		        <if test="sSearch != null and sSearch != '' and searhSystemCode == 'SRD0004'">
	                AND   DEVICE_VERSION LIKE CONCAT('%',#{sSearch},'%')
				</if>
		    <include refid="Common.AfterSQL"/>
	</select>

	<select id="Resource_ListCountResource" parameterType="hashmap" resultType="int">
		/*
		  ID  : resource_sql.Resource_ListCountResource
		  DEC : 접속 상태 카운터
		*/
		SELECT COUNT(*)
        FROM
        (
        	SELECT  A.BRAND_IDX
				      , A.BRAND_NAME
				      , A.FRANC_IDX
				      , A.FRANC_NAME
				      , A.DEVICE_IDX
				      , A.DEVICE_NAME
				      , IFNULL(CPU, '0') AS CPU
				      , IFNULL(RAM, '0') AS RAM
				      , IFNULL(HDD, '0') AS HDD
				      , IFNULL(PRINTER, '0') AS PRINTER
				      , IFNULL(CARD, '0') AS CARD
				      , IFNULL(BARCODE, '0') AS BARCODE
				      , IFNULL(NETWORK, '0') AS NETWORK
				      , IFNULL(DEVICE_VERSION, '') AS DEVICE_VERSION
				      , IFNULL(CONNECT_START_TIME, 0) AS CONNECT_START_TIME
          	  		  , IFNULL(B.MOD_DATE, '') AS MOD_DATE

				FROM
				(
				  SELECT
						K.DOMAIN_IDX
		          	  , K.BRAND_IDX
				      , K.FRANC_IDX
				      , K.DEVICE_IDX
				      , K.DEVICE_NAME
			          , f.FRANC_NAME
			          , b.NAME AS BRAND_NAME
				  FROM KIOSK K
				  		INNER JOIN franchisee f ON  f.DOMAIN_IDX = K.DOMAIN_IDX AND f.BRAND_IDX = K.BRAND_IDX AND f.FRANC_IDX = K.FRANC_IDX AND ifnull(f.DEL_YN, 'N') = 'N'
      					INNER JOIN brand b ON  b.DOMAIN_IDX = K.DOMAIN_IDX AND b.BRAND_IDX = K.BRAND_IDX AND ifnull(b.DEL_YN, 'N') = 'N'
		  		INNER JOIN sitegroup s ON  f.DOMAIN_IDX = s.DOMAIN_IDX AND f.BRAND_IDX = s.BRAND_IDX AND f.GROUP_IDX = s.GROUP_IDX AND ifnull(s.DEL_YN, 'N') = 'N'
				  WHERE IFNULL(K.DEL_YN, 'N') = 'N'
				  <if test="sessionBrandIdx != null and sessionAdminType != '' and sessionAdminType == 'ADM0002'">
				 	/* 서비스 관리자는 해당 서비스에 포함된 모든 매장 포함되게 또는 선택한 매장만 */
					AND K.BRAND_IDX = #{sessionBrandIdx}
				  </if>

				  <if test="sSearch != null and sSearch != '' and (searhSystemCode == 'SRD0001' or searhSystemCode == '')">
	                AND    b.NAME LIKE CONCAT('%',#{sSearch},'%')
	              </if>

	              <if test="sSearch != null and sSearch != '' and searhSystemCode == 'SRD0002'">
	                AND    f.FRANC_NAME LIKE CONCAT('%',#{sSearch},'%')
	              </if>

	              <if test="sSearch != null and sSearch != '' and searhSystemCode == 'SRD0003'">
	                AND    K.DEVICE_NAME LIKE CONCAT('%',#{sSearch},'%')
	              </if>
				 ) A LEFT JOIN
				 (

		        	SELECT BRAND_IDX
						 , FRANC_IDX
						 , DEVICE_IDX
						  , max(case when RESOURCE_NAME = 'CPU' then RESOURCE_VALUE else '0' end) AS CPU
						  , max(case when RESOURCE_NAME = 'RAM' then RESOURCE_VALUE else '0' end) AS RAM
						  , max(case when RESOURCE_NAME = 'HDD' then RESOURCE_VALUE else '0' end) AS HDD
						  , max(case when RESOURCE_NAME = 'PRINTER' then RESOURCE_VALUE else '0' end) AS PRINTER
						  , max(case when RESOURCE_NAME = 'CARD' then RESOURCE_VALUE else '0' end) AS CARD
						  , max(case when RESOURCE_NAME = 'BARCODE' then RESOURCE_VALUE else '0' end) AS BARCODE
						  , max(case when TIMESTAMPDIFF(second, MOD_DATE, now()) &lt;= 60 then '1' else '0' end) AS NETWORK
						  , max(CASE WHEN RESOURCE_NAME = 'VERSION' THEN RESOURCE_VALUE ELSE '' END) AS DEVICE_VERSION
						  , TIMESTAMPDIFF(MINUTE, MAX(CONNECT_START_TIME), now()) AS CONNECT_START_TIME
          		  		  , MAX(MOD_DATE) AS MOD_DATE
					FROM    KIOSK_RESOURCE KR
					WHERE  1 = 1


					GROUP BY BRAND_IDX, FRANC_IDX, DEVICE_IDX
		            ORDER BY BRAND_IDX, FRANC_IDX, DEVICE_IDX
		        ) B
		        ON  A.BRAND_IDX = B.BRAND_IDX
          		AND A.FRANC_IDX = B.FRANC_IDX
          		AND A.DEVICE_IDX = B.DEVICE_IDX
		        WHERE 1 = 1
		        <if test="serchKey != null and serchKey != '' and serchKey == 'CPU'">
		            AND   (IFNULL(CPU, '0') >= 60 AND IFNULL(NETWORK, '0') = 1)
		        </if>
		        <if test="serchKey != null and serchKey != '' and serchKey == 'RAM'">
		            AND   (IFNULL(RAM, '0') >= 60 AND IFNULL(NETWORK, '0') = 1)
		        </if>
		        <if test="serchKey != null and serchKey != '' and serchKey == 'HDD'">
		            AND   (IFNULL(HDD, '0') >= 60 AND IFNULL(NETWORK, '0') = 1)
		        </if>
		        <if test="serchKey != null and serchKey != '' and serchKey == 'PRINTER'">
		            AND   (IFNULL(PRINTER, '0') = 0 OR IFNULL(NETWORK, '0') = 0)
		        </if>
		        <if test="serchKey != null and serchKey != '' and serchKey == 'CARD'">
		            AND   (IFNULL(CARD, '0') = 0 OR IFNULL(NETWORK, '0') = 0)
		        </if>
		        <if test="serchKey != null and serchKey != '' and serchKey == 'BARCODE'">
		            AND   (IFNULL(BARCODE, '0') = 0 OR IFNULL(NETWORK, '0') = 0)
		        </if>
		        <if test="serchKey != null and serchKey != '' and serchKey == 'NETWORK'">
		            AND   IFNULL(NETWORK, '0') = 0
		        </if>
		        <if test="sSearch != null and sSearch != '' and searhSystemCode == 'SRD0004'">
	                AND    DEVICE_VERSION LIKE CONCAT('%',#{sSearch},'%')
				</if>
		 ) A
	</select>

</mapper>