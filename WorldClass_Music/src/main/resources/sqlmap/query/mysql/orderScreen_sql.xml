<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="OrderScreen">

	<select id="OrderScreen_ListOrderScreen" parameterType="qss.vo.OrderScreenVo" resultType="qss.vo.OrderScreenVo">
		/*
		  ID  : orderScreen_sql.OrderScreen_ListOrderScreen
		  DEC : 주문화면 목록 조회
		*/
	    <include refid="Common.BeforeSQL"/>
	    <!-- 시스템 관라지 일경우 -->
		<if test="sessionAdminType != null and sessionAdminType != '' and sessionAdminType == 'ADM0001'">
			SELECT  OS.BRAND_IDX
			      , OS.FRANC_IDX
			      , OS.ORDER_SCREEN_IDX
				  , OS.ORDER_SCREEN_NAME
				  , OS.REG_USER
				  , date_format(OS.MOD_DATE, '%Y-%m-%d') AS MOD_DATE
				  , date_format(OS.REG_DATE, '%Y-%m-%d') AS REG_DATE
				  , (
	                 SELECT COUNT(*)
	                    FROM ORDER_SCREEN_TARGET O, KIOSK K
	                    WHERE O.DOMAIN_IDX = OS.DOMAIN_IDX
	                    AND O.BRAND_IDX = OS.BRAND_IDX
	                    AND O.FRANC_IDX = OS.FRANC_IDX
	                    AND O.ORDER_SCREEN_IDX = OS.ORDER_SCREEN_IDX
	                    AND O.DOMAIN_IDX = K.DOMAIN_IDX
	                    AND O.BRAND_IDX = K.BRAND_IDX
	                    AND O.FRANC_IDX = K.FRANC_IDX
	                    AND O.DEVICE_IDX = K.DEVICE_IDX
	                    AND ifnull(K.DEL_YN, 'N') = 'N'
	              ) TARGET_COUNT
			FROM    ORDER_SCREEN OS
				    INNER JOIN franchisee f ON  f.DOMAIN_IDX = OS.DOMAIN_IDX AND f.BRAND_IDX = OS.BRAND_IDX AND f.FRANC_IDX = OS.FRANC_IDX AND ifnull(f.DEL_YN, 'N') = 'N'
      			    INNER JOIN brand b ON  b.DOMAIN_IDX = OS.DOMAIN_IDX AND b.BRAND_IDX = OS.BRAND_IDX AND ifnull(b.DEL_YN, 'N') = 'N'
			WHERE   ifnull(OS.DEL_YN, 'N') = 'N'
			AND     OS.DOMAIN_IDX = #{domainIdx}
			<!-- 루트 조회 필요 -->
			<if test="brandIdx != null and brandIdx != '' and brandIdx != 0">
				AND OS.BRAND_IDX = #{brandIdx}
			</if>
			<if test="francIdx != null and francIdx != '' and francIdx != 0">
				AND OS.FRANC_IDX = #{francIdx}
			</if>
			<if test="sSearch != null and sSearch != ''">
	            AND OS.ORDER_SCREEN_NAME LIKE CONCAT('%',#{sSearch},'%')
	         </if>

	     </if>
	     <!-- 시스템 관라지가 아닐경우(브랜드, 매장 관리자) -->
		 <if test="sessionAdminType != null and sessionAdminType != '' and sessionAdminType != 'ADM0001'">
		 	SELECT  OS.BRAND_IDX
			      , OS.FRANC_IDX
			      , OS.ORDER_SCREEN_IDX
				  , OS.ORDER_SCREEN_NAME
				  , OS.REG_USER
				  , date_format(OS.MOD_DATE, '%Y-%m-%d') AS MOD_DATE
				  , date_format(OS.REG_DATE, '%Y-%m-%d') AS REG_DATE
				  , (
	                 SELECT COUNT(*)
	                    FROM ORDER_SCREEN_TARGET O, KIOSK K
	                    WHERE O.DOMAIN_IDX = OS.DOMAIN_IDX
	                    AND O.BRAND_IDX = OS.BRAND_IDX
	                    AND O.FRANC_IDX = OS.FRANC_IDX
	                    AND O.ORDER_SCREEN_IDX = OS.ORDER_SCREEN_IDX
	                    AND O.DOMAIN_IDX = K.DOMAIN_IDX
	                    AND O.BRAND_IDX = K.BRAND_IDX
	                    AND O.FRANC_IDX = K.FRANC_IDX
	                    AND O.DEVICE_IDX = K.DEVICE_IDX
	                    AND ifnull(K.DEL_YN, 'N') = 'N'
	              ) TARGET_COUNT
			FROM    ORDER_SCREEN OS
					INNER JOIN franchisee f ON  f.DOMAIN_IDX = OS.DOMAIN_IDX AND f.BRAND_IDX = OS.BRAND_IDX AND f.FRANC_IDX = OS.FRANC_IDX AND ifnull(f.DEL_YN, 'N') = 'N'
      			    INNER JOIN brand b ON  b.DOMAIN_IDX = OS.DOMAIN_IDX AND b.BRAND_IDX = OS.BRAND_IDX AND ifnull(b.DEL_YN, 'N') = 'N'
			WHERE   ifnull(OS.DEL_YN, 'N') = 'N'
			AND     OS.DOMAIN_IDX = #{domainIdx}
			/* 브랜드 관리자는 해당 브랜드에 포함된 모든 매장 포함되게 또는 선택한 매자만 */
			<if test="sessionBrandIdx != null and sessionAdminType != '' and sessionAdminType == 'ADM0002'">
				AND OS.BRAND_IDX = #{sessionBrandIdx}
			</if>
			<if test="francIdx != null and francIdx != '' and francIdx != 0">
				AND OS.FRANC_IDX = #{francIdx}

			</if>

			/* 매장 관리자는 자신이 속한 브랜드의 자기 매장만 보이게 */
			<if test="sessionBrandIdx != null and sessionAdminType != '' and sessionAdminType == 'ADM0003'">
				AND OS.BRAND_IDX = #{sessionBrandIdx}
				AND OS.FRANC_IDX = #{sessionFrancIdx}
			</if>
			<if test="sSearch != null and sSearch != ''">
	            AND OS.ORDER_SCREEN_NAME LIKE CONCAT('%',#{sSearch},'%')
	         </if>
		 </if>
		 <if test="sSortName == null or sSortName == ''">
<!-- 		 ORDER BY OS.REG_DATE -->
		 </if>
		<include refid="Common.AfterSQL"/>
	</select>

	<select id="OrderScreen_ListCountOrderScreen" parameterType="qss.vo.OrderScreenVo" resultType="int">
		/*
		  ID  : orderScreen_sql.OrderScreen_ListCountOrderScreen
		  DEC : 주문화면 카운터
		*/
		 <!-- 시스템 관라지 일경우 -->
		<if test="sessionAdminType != null and sessionAdminType != '' and sessionAdminType == 'ADM0001'">
			SELECT  COUNT(OS.DOMAIN_IDX)
			FROM    ORDER_SCREEN OS
					INNER JOIN franchisee f ON  f.DOMAIN_IDX = OS.DOMAIN_IDX AND f.BRAND_IDX = OS.BRAND_IDX AND f.FRANC_IDX = OS.FRANC_IDX AND ifnull(f.DEL_YN, 'N') = 'N'
      			    INNER JOIN brand b ON  b.DOMAIN_IDX = OS.DOMAIN_IDX AND b.BRAND_IDX = OS.BRAND_IDX AND ifnull(b.DEL_YN, 'N') = 'N'
			WHERE   ifnull(OS.DEL_YN, 'N') = 'N'
			AND     OS.DOMAIN_IDX = #{domainIdx}
			<!-- 루트 조회 필요 -->
			<if test="brandIdx != null and brandIdx != '' and brandIdx != 0">
				AND OS.BRAND_IDX = #{brandIdx}
			</if>
			<if test="francIdx != null and francIdx != '' and francIdx != 0">
				AND OS.FRANC_IDX = #{francIdx}
			</if>
			<if test="sSearch != null and sSearch != ''">
	            AND OS.ORDER_SCREEN_NAME LIKE CONCAT('%',#{sSearch},'%')
	         </if>
	    </if>
	     <!-- 시스템 관라지가 아닐경우(브랜드, 매장 관리자) -->
		 <if test="sessionAdminType != null and sessionAdminType != '' and sessionAdminType != 'ADM0001'">
		 	SELECT  COUNT(OS.DOMAIN_IDX)
			FROM    ORDER_SCREEN OS
					INNER JOIN franchisee f ON  f.DOMAIN_IDX = OS.DOMAIN_IDX AND f.BRAND_IDX = OS.BRAND_IDX AND f.FRANC_IDX = OS.FRANC_IDX AND ifnull(f.DEL_YN, 'N') = 'N'
      			    INNER JOIN brand b ON  b.DOMAIN_IDX = OS.DOMAIN_IDX AND b.BRAND_IDX = OS.BRAND_IDX AND ifnull(b.DEL_YN, 'N') = 'N'
			WHERE   ifnull(OS.DEL_YN, 'N') = 'N'
			AND     OS.DOMAIN_IDX = #{domainIdx}
			/* 브랜드 관리자는 해당 브랜드에 포함된 모든 매장 포함되게 또는 선택한 매자만 */
			<if test="sessionBrandIdx != null and sessionAdminType != '' and sessionAdminType == 'ADM0002'">
				AND OS.BRAND_IDX = #{sessionBrandIdx}
			</if>
			<if test="francIdx != null and francIdx != '' and francIdx != 0">
				AND OS.FRANC_IDX = #{francIdx}
			</if>

			/* 매장 관리자는 자신이 속한 브랜드의 자기 매장만 보이게 */
			<if test="sessionBrandIdx != null and sessionAdminType != '' and sessionAdminType == 'ADM0003'">
				AND OS.BRAND_IDX = #{sessionBrandIdx}
				AND OS.FRANC_IDX = #{sessionFrancIdx}
			</if>
			<if test="sSearch != null and sSearch != ''">
	            AND OS.ORDER_SCREEN_NAME LIKE CONCAT('%',#{sSearch},'%')
	         </if>
		 </if>
	</select>

	<insert id="OrderScreen_InsertOrderScreen" parameterType="qss.vo.OrderScreenVo">
		/*
		  ID  : orderScreen_sql.OrderScreen_InsertOrderScreen
		  DEC : 주문화면  저장
		*/
		<selectKey keyProperty="orderScreenIdx" resultType="biginteger" order="BEFORE">
			SELECT IFNULL(MAX(ORDER_SCREEN_IDX) + 1, '1')
			FROM   ORDER_SCREEN
			WHERE  DOMAIN_IDX = #{domainIdx}
			AND    BRAND_IDX = #{brandIdx}
			AND    FRANC_IDX = #{francIdx}
		</selectKey>
		INSERT INTO ORDER_SCREEN (
		   FRANC_IDX
		  ,DOMAIN_IDX
		  ,BRAND_IDX
		  ,ORDER_SCREEN_IDX
		  ,ORDER_SCREEN_NAME
		  ,DEL_YN
		  ,REG_USER
		  ,REG_DATE
		  ,MOD_USER
		  ,MOD_DATE
		) VALUES (
		   #{francIdx}
		  ,#{domainIdx}
		  ,#{brandIdx}
		  ,#{orderScreenIdx}
		  ,#{orderScreenName}
		  ,'N'
		  ,#{regUser}
		  ,now()
		  ,#{regUser}
		  ,now()
		)

	</insert>

	<update id="OrderScreen_UpdateOrderScreen" parameterType="qss.vo.OrderScreenVo">
		/*
		  ID  : orderScreen_sql.OrderScreen_UpdateOrderScreen
		  DEC : 주문화면  수정
		*/
		UPDATE ORDER_SCREEN
		SET    ORDER_SCREEN_NAME = #{orderScreenName}
		      ,MOD_USER = #{regUser}
		      ,MOD_DATE = now()
		WHERE  DOMAIN_IDX = #{domainIdx}
		  AND  BRAND_IDX = #{brandIdx}
		  AND  FRANC_IDX = #{francIdx}
		  AND  ORDER_SCREEN_IDX = #{orderScreenIdx}
	</update>

	<update id="OrderScreen_DeleteOrderScreen"  parameterType="qss.vo.OrderScreenVo">
		/*
		  ID  : orderScreen_sql.OrderScreen_DeleteOrderScreen
		  DEC : 주문화면 삭제
		*/
		UPDATE ORDER_SCREEN
		SET    DEL_YN = 'Y'
		     , MOD_USER = #{regUser}
		     , MOD_DATE = now()
		WHERE  DOMAIN_IDX = #{domainIdx}
		AND    BRAND_IDX = #{brandIdx}
		AND    FRANC_IDX = #{francIdx}
		AND    ORDER_SCREEN_IDX IN
		<foreach collection="checkboxArr" item="id" open="(" close=")" separator=",">
	        #{id}
	    </foreach>
	</update>

	<select id="OrderScreen_ViewOrderScreen" parameterType="qss.vo.OrderScreenVo" resultType="qss.vo.OrderScreenVo">
		/*
		  ID  : orderScreen_sql.OrderScreen_ViewOrderScreen
		  DEC : 주문화면 상세 조회
		*/
	    SELECT  BRAND_IDX
		      , FRANC_IDX
		      , ORDER_SCREEN_IDX
			  , ORDER_SCREEN_NAME
			  , REG_USER
			  , date_format(REG_DATE, '%Y-%m-%d') AS REG_DATE
			  , (
				     SELECT COUNT(*)
				     FROM ORDER_SCREEN_TARGET
				     WHERE DOMAIN_IDX = OS.DOMAIN_IDX
				     AND BRAND_IDX = OS.BRAND_IDX
				     AND FRANC_IDX = OS.FRANC_IDX
				     AND ORDER_SCREEN_IDX = OS.ORDER_SCREEN_IDX
			     ) TARGET_COUNT
		FROM    ORDER_SCREEN OS
		WHERE   ifnull(DEL_YN, 'N') = 'N'
		AND     DOMAIN_IDX = #{domainIdx}
		AND     BRAND_IDX = #{brandIdx}
		AND     FRANC_IDX = #{francIdx}
		AND     ORDER_SCREEN_IDX = #{orderScreenIdx}

	</select>

	<select id="OrderScreen_TreeOrderScreenTarget" parameterType="qss.vo.OrderScreenVo" resultType="hashmap">
		/*
		  ID  : orderScreen_sql.OrderScreen_TreeOrderScreenTarget
		  DEC : 주문화면 트리 조회
		*/
		SELECT
		  A.DEPTH
		  ,A.DEPTH_NAME
		  ,A.IDX
		  ,A.NAME
		  ,A.PARENT_IDX
		  ,IF((SELECT IFNULL(MAX(TR.DEVICE_IDX), '0') FROM ORDER_SCREEN_TARGET TR WHERE TR.DOMAIN_IDX = A.DOMAIN_IDX AND TR.BRAND_IDX = A.BRAND_IDX AND TR.FRANC_IDX = A.FRANC_IDX AND TR.DEVICE_IDX = A.DEVICE_IDX and TR.ORDER_SCREEN_IDX = #{orderScreenIdx})
		      = '0', '0', '1') AS CHECKED
		FROM
		(
		    SELECT  '1' AS DEPTH
				      , 'DOMAIN' AS DEPTH_NAME
				      , DOMAIN_IDX AS IDX
				      , DOMAIN_NAME AS NAME
				      , '0' AS PARENT_IDX
				      , '0' AS CHECKED
		          , DOMAIN_IDX
		          , '0' AS BRAND_IDX
		          , '0' AS FRANC_IDX
		          ,'0' AS DEVICE_IDX
				FROM DOMAIN WHERE DOMAIN_IDX = #{domainIdx}
				UNION ALL
				SELECT  '2'
				      , 'BRAND'
				      , CONCAT(DOMAIN_IDX, '_', BRAND_IDX)
				      , NAME
				      , DOMAIN_IDX
				      , '0'
		          , DOMAIN_IDX
		          , BRAND_IDX
		          , '0' AS FRANC_IDX
		          ,'0' AS DEVICE_IDX
				FROM    BRAND
				WHERE   ifnull(DEL_YN, 'N') = 'N' AND DOMAIN_IDX = #{domainIdx} AND BRAND_IDX = #{brandIdx}
				UNION ALL
				SELECT  '3'
				     , 'FRANCHISEE'
				     , CONCAT(DOMAIN_IDX, '_', BRAND_IDX, '_', FRANC_IDX)
				     , FRANC_NAME
				     , CONCAT(DOMAIN_IDX, '_', BRAND_IDX)
		         , '0'
		         , DOMAIN_IDX
		         , BRAND_IDX
		         , FRANC_IDX
		         ,'0' AS DEVICE_IDX
				FROM   FRANCHISEE
				WHERE  ifnull(DEL_YN, 'N') = 'N' AND DOMAIN_IDX = #{domainIdx} AND BRAND_IDX = #{brandIdx} AND FRANC_IDX = #{francIdx}
				UNION ALL
				SELECT  '4'
				     , 'KIOSK'
				     , CONCAT(DOMAIN_IDX, '_', BRAND_IDX, '_', FRANC_IDX, '_', kiosk.DEVICE_IDX)
				     , DEVICE_NAME
				     , CONCAT(DOMAIN_IDX, '_', BRAND_IDX, '_', FRANC_IDX)
		         , '0'
		         , DOMAIN_IDX
		         , BRAND_IDX
		         , FRANC_IDX
		         , DEVICE_IDX
				FROM   KIOSK WHERE ifnull(DEL_YN, 'N') = 'N' AND DOMAIN_IDX = #{domainIdx} AND BRAND_IDX = #{brandIdx} AND FRANC_IDX = #{francIdx}
		) AS A

	</select>

	<update id="OrderScree_DeleteOrderScreenTarget" parameterType="qss.vo.OrderScreenVo">
	    /*
		  ID  : orderScreen_sql.OrderScree_DeleteOrderScreeTarget
		  DEC : 주문화면 타겟 삭제
		*/
		DELETE FROM ORDER_SCREEN_TARGET
		WHERE  DOMAIN_IDX = #{domainIdx}
		AND    BRAND_IDX = #{brandIdx}
		AND    FRANC_IDX = #{francIdx}
		AND    ORDER_SCREEN_IDX = #{orderScreenIdx}
	</update>

	<update id="OrderScree_InsertOrderScreenTarget" parameterType="qss.vo.OrderScreenVo">
	    /*
		  ID  : orderScreen_sql.OrderScree_InsertOrderScreenTarget
		  DEC : 주문화면 타겟 저장
		*/
		INSERT INTO ORDER_SCREEN_TARGET (
		   FRANC_IDX
		  ,DOMAIN_IDX
		  ,BRAND_IDX
		  ,ORDER_SCREEN_IDX
		  ,DEVICE_IDX
		  ,REG_USER
		  ,REG_DATE
		  ,MOD_USER
		  ,MOD_DATE
		) VALUES (
		   #{francIdx}
		  ,#{domainIdx}
		  ,#{brandIdx}
		  ,#{orderScreenIdx}
		  ,#{deviceIdx}
		  ,#{regUser}
		  ,now()
		  ,#{regUser}
		  ,now()
		)
	</update>

	<update id="OrderScree_DeleteOrderScreenMenu" parameterType="qss.vo.OrderScreenVo">
	    /*
		  ID  : orderScreen_sql.OrderScree_DeleteOrderScreenMenu
		  DEC : 주문화면 메뉴 삭제
		*/
		DELETE FROM ORDER_SCREEN_MENU
		WHERE  DOMAIN_IDX = #{domainIdx}
		AND    BRAND_IDX = #{brandIdx}
		AND    FRANC_IDX = #{francIdx}
		AND    ORDER_SCREEN_IDX = #{orderScreenIdx}
	</update>

	<update id="OrderScree_DeleteOrderScreenMenuItem" parameterType="qss.vo.OrderScreenVo">
	    /*
		  ID  : orderScreen_sql.OrderScree_DeleteOrderScreenMenuItem
		  DEC : 주문화면 메뉴 아이템 삭제
		*/
		DELETE FROM ORDER_SCREEN_MENU_ITEM
		WHERE  DOMAIN_IDX = #{domainIdx}
		AND    BRAND_IDX = #{brandIdx}
		AND    FRANC_IDX = #{francIdx}
		AND    ORDER_SCREEN_IDX = #{orderScreenIdx}
	</update>

	<update id="OrderScree_InsertOrderScreenMenu" parameterType="qss.vo.OrderScreenVo">
	    /*
		  ID  : orderScreen_sql.OrderScree_InsertOrderScreenMenu
		  DEC : 주문화면 메뉴 저장
		*/
		INSERT INTO ORDER_SCREEN_MENU (
		   FRANC_IDX
		  ,DOMAIN_IDX
		  ,BRAND_IDX
		  ,ORDER_SCREEN_IDX
		  ,ORDER_SCREEN_MENU_IDX
		  ,PARENT_IDX
		  ,MENU_LEVEL
		  ,MENU_NAME
		  ,MENU_ENG_NAME
		  ,ORDER_SEQ
		  ,REG_USER
		  ,REG_DATE
		  ,MOD_USER
		  ,MOD_DATE
		) VALUES (
		   #{francIdx}
		  ,#{domainIdx}
		  ,#{brandIdx}
		  ,#{orderScreenIdx}
		  ,#{orderScreenMenuIdx}
		  ,0
		  ,1
		  ,#{menuName}
		  ,#{menuEngName}
		  ,#{orderScreenMenuIdx}
		  ,#{regUser}
		  ,now()
		  ,#{regUser}
		  ,now()
		)
	</update>

	<update id="OrderScree_InsertOrderScreenMenuItem" parameterType="qss.vo.OrderScreenVo">
	    /*
		  ID  : orderScreen_sql.OrderScree_InsertOrderScreenMenuItem
		  DEC : 주문화면 메뉴 아이템 저장
		*/
		<selectKey keyProperty="orderScreenMenuItemIdx" resultType="biginteger" order="BEFORE">
			SELECT IFNULL(MAX(ORDER_SCREEN_MENU_ITEM_IDX) + 1, 1)
			FROM   ORDER_SCREEN_MENU_ITEM
			WHERE  DOMAIN_IDX = #{domainIdx}
			AND    BRAND_IDX = #{brandIdx}
			AND    FRANC_IDX = #{francIdx}
			AND    ORDER_SCREEN_IDX = #{orderScreenIdx}
			AND    ORDER_SCREEN_MENU_IDX = #{orderScreenMenuIdx}
		</selectKey>
		INSERT INTO ORDER_SCREEN_MENU_ITEM (
		   FRANC_IDX
		  ,DOMAIN_IDX
		  ,BRAND_IDX
		  ,ORDER_SCREEN_IDX
		  ,ORDER_PROD_IDX
		  ,ORDER_SCREEN_MENU_IDX
		  ,ORDER_SCREEN_MENU_ITEM_IDX
		  ,ORDER_SEQ
		  ,REG_USER
		  ,REG_DATE
		  ,MOD_USER
		  ,MOD_DATE
		  ,STATE_CODE
		) VALUES (
		   #{francIdx}
		  ,#{domainIdx}
		  ,#{brandIdx}
		  ,#{orderScreenIdx}
		  ,#{orderProdIdx}
		  ,#{orderScreenMenuIdx}
		  ,#{orderScreenMenuItemIdx}
		  ,#{orderScreenMenuItemIdx}
		  ,#{regUser}
		  ,now()
		  ,#{regUser}
		  ,now()
		  ,#{stateCode}
		)
	</update>

	<select id="OrderScreen_ListOrderScreenMenu" parameterType="qss.vo.OrderScreenVo" resultType="qss.vo.OrderScreenVo">
		/*
		  ID  : orderScreen_sql.OrderScreen_ListOrderScreenMenu
		  DEC : 주문화면 메뉴 조회
		*/
		SELECT   ORDER_SCREEN_MENU_IDX
				,PARENT_IDX
				,MENU_LEVEL
				,MENU_NAME
				,MENU_ENG_NAME
				,ORDER_SEQ
	    FROM     ORDER_SCREEN_MENU
	    WHERE    DOMAIN_IDX = #{domainIdx}
	    AND      BRAND_IDX = #{brandIdx}
	    AND      FRANC_IDX = #{francIdx}
	    AND      ORDER_SCREEN_IDX = #{orderScreenIdx}
	</select>

	<select id="OrderScreen_ListOrderScreenMenuItem" parameterType="qss.vo.OrderScreenVo" resultType="qss.vo.OrderScreenVo">
		/*
		  ID  : orderScreen_sql.OrderScreen_ListOrderScreenMenuItem
		  DEC : 주문화면 메뉴 아이템 조회
		*/
		SELECT *
		FROM
		(
		    SELECT    A.ORDER_PROD_IDX
				     ,A.ORDER_SCREEN_MENU_IDX
				     ,A.ORDER_SCREEN_MENU_ITEM_IDX
				     ,PROD_NAME
				     ,PROD_DISPLAY_NAME
				     ,PROD_CODE
				     ,PROD_EN_NAME
				     ,PROD_AMOUNT
				     ,PROD_DISCOUNT_AMOUNT
				     ,A.ORDER_SCREEN_MENU_IDX AS ORDER_SEQ
				     ,A.DOMAIN_IDX
				     ,A.BRAND_IDX
				     ,A.FRANC_IDX
				     ,A.ORDER_SCREEN_IDX
				     ,(SELECT SAVE_PATH FROM file_content WHERE FILE_CONTENT_IDX = B.PROD_IMAGE) AS THUMBNAIL_PATH
				     ,A.STATE_CODE
			FROM      ORDER_SCREEN_MENU_ITEM A
			JOIN ORDER_PROD B
			ON        A.DOMAIN_IDX = B.DOMAIN_IDX
		    AND       A.BRAND_IDX = B.BRAND_IDX
			AND       A.FRANC_IDX = B.FRANC_IDX
			AND       A.ORDER_PROD_IDX = B.ORDER_PROD_IDX
			AND       ifnull(B.DEL_YN, 'N') = 'N'
			AND       ifnull(B.ACTIVE_YN, 'Y') = 'Y'
			LEFT JOIN ORDER_SCREEN_MENU C
			ON        A.DOMAIN_IDX = C.DOMAIN_IDX
		    AND       A.BRAND_IDX = C.BRAND_IDX
			AND       A.FRANC_IDX = C.FRANC_IDX
			AND       A.ORDER_SCREEN_IDX = C.ORDER_SCREEN_IDX
		    AND       A.ORDER_SCREEN_MENU_IDX = C.ORDER_SCREEN_MENU_IDX

		) A
		WHERE A.ORDER_SCREEN_MENU_IDX = #{orderScreenMenuIdx}
		AND   A.DOMAIN_IDX = #{domainIdx}
		AND   A.BRAND_IDX = #{brandIdx}
		AND   A.FRANC_IDX = #{francIdx}
		AND   A.ORDER_SCREEN_IDX = #{orderScreenIdx}
	    ORDER BY A.ORDER_SCREEN_MENU_IDX, A.ORDER_SCREEN_MENU_ITEM_IDX
	</select>

	<insert id="OrderScreen_InsertScheduleVersion" parameterType="qss.vo.OrderScreenVo">
		/*
		  ID  : orderScreen_sql.OrderScreen_InsertScheduleVersion
		  DEC : 주문화면 기준 스케줄버전 추가
		  USAGE : 주문화면 관리 > 주문화면 저장/수정/삭제
		*/
		INSERT INTO SCHEDULE_VERSION
		(
		  DEVICE_CODE
		 ,SCHEDULE_VERSION_IDX
		 ,SCHEDULE_TYPE
		 ,MOD_REASON
		 ,REG_USER
		 ,REG_DATE
		 ,MOD_USER
		 ,MOD_DATE
		)
		SELECT  DEVICE_CODE
		       ,(
			   		SELECT IFNULL(MAX(SCHEDULE_VERSION_IDX) + 1, 1)
			   		FROM   SCHEDULE_VERSION
			   		WHERE  DEVICE_CODE = A.DEVICE_CODE
<!-- 			   		AND    SCHEDULE_TYPE = #{scheduleType} -->
			   	) AS SCHEDULE_VERSION_IDX
		       ,#{scheduleType} AS SCHEDULE_TYPE
		       ,(
		       		SELECT CODE_NAME
		       		FROM   SYSTEM_CODE
		       		WHERE  CODE_GROUP = 'SCH0000' AND  CODE_VALUE = #{scheduleType}
		       		AND    IFNULL(DEL_YN, 'N') = 'N'
		       	) AS MOD_REASON
		       ,#{regUser} AS REG_USER
		       ,now() AS REG_DATE
		       ,#{regUser} AS MOD_USER
			   ,now() AS MOD_DATE
		FROM
		(
			SELECT K.DEVICE_CODE
			FROM   KIOSK K, ORDER_SCREEN_TARGET OST
			WHERE  K.DOMAIN_IDX = OST.DOMAIN_IDX
			AND    K.BRAND_IDX = OST.BRAND_IDX
			AND    K.FRANC_IDX = OST.FRANC_IDX
			AND    K.DOMAIN_IDX = #{domainIdx}
			AND    K.BRAND_IDX = #{brandIdx}
			AND    K.FRANC_IDX = #{francIdx}
			AND    K.DEVICE_IDX = OST.DEVICE_IDX
			AND    IFNULL(K.DEL_YN, 'N') = 'N'
			AND    ORDER_SCREEN_IDX = #{orderScreenIdx}
			UNION
			SELECT DEVICE_CODE
			FROM   KIOSK
			WHERE  DOMAIN_IDX = #{domainIdx}
			AND    BRAND_IDX = #{brandIdx}
			AND    FRANC_IDX = #{francIdx}
			AND    IFNULL(DEL_YN, 'N') = 'N'
			AND    DEVICE_IDX IN
			<foreach collection="checkboxArr" item="id" open="(" close=")" separator=",">
		        #{id}
		    </foreach>
		) A
	</insert>

	<insert id="OrderScreen_InsertDelScheduleVersion" parameterType="qss.vo.OrderScreenVo">
		/*
		  ID  : orderScreen_sql.OrderScreen_InsertDelScheduleVersion
		  DEC : 주문화면 기준 스케줄버전 추가(삭제 전용)
		  USAGE : 주문화면 관리 > 주문화면 저장/수정/삭제
		*/
		INSERT INTO SCHEDULE_VERSION
		(
		  DEVICE_CODE
		 ,SCHEDULE_VERSION_IDX
		 ,SCHEDULE_TYPE
		 ,MOD_REASON
		 ,REG_USER
		 ,REG_DATE
		 ,MOD_USER
		 ,MOD_DATE
		)
		SELECT  DEVICE_CODE
		       ,(
			   		SELECT IFNULL(MAX(SCHEDULE_VERSION_IDX) + 1, 1)
			   		FROM   SCHEDULE_VERSION
			   		WHERE  DEVICE_CODE = A.DEVICE_CODE
			   		AND    SCHEDULE_TYPE = #{scheduleType}
			   	) AS SCHEDULE_VERSION_IDX
		       ,#{scheduleType} AS SCHEDULE_TYPE
		       ,(
		       		SELECT CODE_NAME
		       		FROM   SYSTEM_CODE
		       		WHERE  CODE_VALUE = #{scheduleType}
		       		AND    IFNULL(DEL_YN, 'N') = 'N'
		       	) AS MOD_REASON
		       ,#{regUser} AS REG_USER
		       ,now() AS REG_DATE
		       ,#{regUser} AS MOD_USER
			   ,now() AS MOD_DATE
		FROM
		(
			SELECT K.DEVICE_CODE
			FROM   KIOSK K, ORDER_SCREEN_TARGET OST
			WHERE  K.DOMAIN_IDX = OST.DOMAIN_IDX
			AND    K.BRAND_IDX = OST.BRAND_IDX
			AND    K.FRANC_IDX = OST.FRANC_IDX
			AND    K.DOMAIN_IDX = #{domainIdx}
			AND    K.BRAND_IDX = #{brandIdx}
			AND    K.FRANC_IDX = #{francIdx}
			AND    K.DEVICE_IDX = OST.DEVICE_IDX
			AND    ORDER_SCREEN_IDX IN
			<foreach collection="checkboxArr" item="id" open="(" close=")" separator=",">
		        #{id}
		    </foreach>
		    GROUP BY K.DOMAIN_IDX, K.BRAND_IDX, K.FRANC_IDX, K.DEVICE_IDX
		) A
	</insert>

</mapper>